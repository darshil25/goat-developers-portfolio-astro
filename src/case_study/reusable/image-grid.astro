---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  images: ImageMetadata[];
  hideOnMobileIndices?: number[];
  ariaLabel?: string;
  spans?: number[];
}

const { images, hideOnMobileIndices = [], ariaLabel = 'Image gallery', spans = [5, 7, 5, 4, 4, 4] } = Astro.props;
const AREAS = ['a', 'b', 'c', 'd', 'e', 'f'];

const shouldHideOnMobile = (index: number) => hideOnMobileIndices.includes(index);
---

<section class="container" aria-label={ariaLabel}>
  <div class="grid gap-x-2 gap-y-2 md:gap-y-3">
    {images.map((src, idx) => {
      const hideClass = shouldHideOnMobile(idx) ? 'hideMobile' : '';
      const areaClass = AREAS[idx];
      const spanValue = spans[idx] || 4;
      
      return (
        <div class={`item ${areaClass} ${hideClass}`} style={`--span: ${spanValue}`}>
          <Image
            src={src}
            alt={`Image ${idx + 1}`}
            width={src.width} 
            height={src.height}
            class="object-cover"
          />
        </div>
      );
    })}
  </div>
</section>

<style>
  .container {
    width: 100%;
    display: flex;
    justify-content: center;
    padding: 8px 16px;
  }

  .grid {
    display: grid;
    width: 100%;
    max-width: 1140px;
    grid-template-columns: repeat(12, 1fr);
    grid-template-rows: auto auto auto;
    grid-template-areas:
      'a b b'
      'c b b'
      'd e f';
    align-items: stretch;
  }

  .item {
    position: relative;
    width: 100%;
    border-radius: 12px;
    overflow: hidden;
  }

  .item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .a {
    grid-area: a;
    aspect-ratio: 1.69/1;
    grid-column: span var(--span, 5);
  }
  .b {
    grid-area: b;
    aspect-ratio: 1.11/1;
    grid-column: span var(--span, 7);
  }
  .c {
    grid-area: c;
    aspect-ratio: 1.69/1;
    grid-column: span var(--span, 5);
  }
  .d {
    grid-area: d;
    aspect-ratio: 1.33/1;
    grid-column: span var(--span, 4);
  }
  .e {
    grid-area: e;
    aspect-ratio: 1.33/1;
    grid-column: span var(--span, 4);
  }
  .f {
    grid-area: f;
    aspect-ratio: 1.33/1;
    grid-column: span var(--span, 4);
  }

  @media (hover: hover) and (pointer: fine) {
    .item img {
      transition: transform 360ms cubic-bezier(0.22, 0.8, 0.2, 1);
      will-change: transform;
    }

    .item:hover img,
    .item:focus-within img {
      transform: scale(1.1);
    }
  }

  /* --- Mobile Styles (< 600px) --- */
  @media (max-width: 600px) {
    .grid {
      grid-template-columns: 1fr;
      grid-template-areas:
        'a'
        'b'
        'e'
        'd';
    }

    /* Reset columns for mobile flow */
    .a, .b, .c, .d, .e, .f {
      grid-column: span 1;
      aspect-ratio: 1 / 1;
    }

    .item {
      width: 100%;
      border-radius: 10px;
    }

    .hideMobile {
      display: none !important;
    }
  }

  /* --- Tablet Styles (600px - 1000px) --- */
  @media (min-width: 600px) and (max-width: 1000px) {
    .container {
      width: 100%;
      margin: 0 auto;
    }
  }
</style>