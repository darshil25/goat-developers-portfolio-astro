---
import { cn } from "@/lib/utils";

interface Props {
  link?: string;
  buttonClass?: string;
  radius?: number | string;
  size?: number | string;
  offsetX?: number | string;
  offsetY?: number | string;
  class?: string;
}

const {
  link = "",
  buttonClass,
  radius = 16,
  size = 16,
  offsetX = 16,
  offsetY = 8,
  class: className,
} = Astro.props;

// Helper to ensure values have units
const formatVal = (val: number | string) =>
  typeof val === "number" ? `${val}px` : val;

// We pass the CSS variables dynamically to the specific element
const cssVars = {
  "--r": formatVal(radius),
  "--s": formatVal(size),
  "--x": formatVal(offsetX),
  "--y": formatVal(offsetY),
};
---

<a href={link} class="relative block cursor-pointer group">
  {/* The Masked Container */}
  <div class={cn("relative inverted-radius", className)} style={cssVars}>
    <slot />
  </div>

  {/* The Button (Arrow) */}
  <div
    class={cn(
      "z-10 absolute bottom-0 right-0 rounded-full bg-[#100f13] flex items-center justify-center transition-transform duration-300 group-hover:scale-110",
      buttonClass
    )}
  >
    {/* Inline SVG for the Arrow (Standard diagonal arrow) */}
    <svg
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      class="text-white w-[50%] h-[50%]"
    >
      <path
        d="M7 17L17 7M17 7H7M17 7V17"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"></path>
    </svg>
  </div>
</a>

<style>
  /* Complex masking logic kept in CSS for readability and stability.
    Tailwind is great, but complex 'calc' + 'conic-gradient' masks 
    are cleaner in standard CSS.
  */
  .inverted-radius {
    border-radius: var(--r);
    
    /* Define variables for the mask calculation */
    --_m: /calc(2 * var(--r)) calc(2 * var(--r))
      radial-gradient(#000 70%, #0000 72%);
      
    --_g: conic-gradient(
      from 90deg at calc(100% - var(--r)) calc(100% - var(--r)),
      #0000 25%,
      #000 0
    );
    
    --_d: calc(var(--s) + var(--r));

    /* Apply the mask */
    mask:
      calc(100% - var(--_d) - var(--x)) 100% var(--_m),
      100% calc(100% - var(--_d) - var(--y)) var(--_m),
      radial-gradient(var(--s) at 100% 100%, #0000 99%, #000 calc(100% + 1px))
        calc(-1 * var(--r) - var(--x)) calc(-1 * var(--r) - var(--y)),
      var(--_g) calc(-1 * var(--_d) - var(--x)) 0,
      var(--_g) 0 calc(-1 * var(--_d) - var(--y));
      
    mask-repeat: no-repeat;
    
    /* Webkit support for Safari/Chrome */
    -webkit-mask:
      calc(100% - var(--_d) - var(--x)) 100% var(--_m),
      100% calc(100% - var(--_d) - var(--y)) var(--_m),
      radial-gradient(var(--s) at 100% 100%, #0000 99%, #000 calc(100% + 1px))
        calc(-1 * var(--r) - var(--x)) calc(-1 * var(--r) - var(--y)),
      var(--_g) calc(-1 * var(--_d) - var(--x)) 0,
      var(--_g) 0 calc(-1 * var(--_d) - var(--y));
    -webkit-mask-repeat: no-repeat;
  }
</style>