---
import { cn } from "../../../../lib/utils";
import CodeIcon from '../../../svg/Code.astro';
import GeometryIcon from '../../../svg/geometry.astro';

interface Props {
  className?: string;
  style?: Record<string, any>;
}

const { className, style } = Astro.props;
const pathname = Astro.url.pathname;

// Determine active state on the server for initial load
const isDesign = pathname.includes('/design');
const activeSection = isDesign ? 'geometry' : 'code';

const sections = [
  { id: 'code', href: '/', Icon: CodeIcon },
  { id: 'geometry', href: '/design', Icon: GeometryIcon }
];
---

<div
  class:list={[
    "flex items-center gap-2 backdrop-blur-[24px] border-none rounded-lg px-3 py-2 shadow-2xl section-switcher text-white",
    className
  ]}
  style={{ background: "rgba(255, 255, 255, 0.08)", ...(style || {}) }}
>
  {sections.map(({ id, href, Icon }) => {
    const isActive = activeSection === id;
    
    return (
      <div class="relative group">
        <div class:list={[
          "section-icon-wrapper p-[0.5px] rounded-sm flex items-center transition-opacity duration-300",
          isActive ? "opacity-100 bg-white/5 shadow-inner" : "opacity-50 hover:opacity-80"
        ]}>
          <a
            href={href}
            class="section-icon px-2 py-1 rounded-sm cursor-pointer block"
            data-section={id}
          >
            <Icon />
          </a>
          {isActive && (
            <div class="absolute inset-0 pointer-events-none rounded-sm border-anim-layer" />
          )}
        </div>
      </div>
    );
  })}
</div>

<style>
  .border-anim-layer {
    border: 0.5px solid transparent;
    background: linear-gradient(90deg, #00000000 0%, #eeeeee 17%, #a6a6a6 88%, #00000000 100%) border-box;
    -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: destination-out;
    mask-composite: exclude;
  }

  @media (max-width: 640px) {
    .section-switcher {
      padding: 8px 4px;
      gap: 4px;
    }
    .section-icon {
      padding: 6px 10px; 
    }
  }
</style>

<script>
  document.addEventListener('astro:page-load', () => {
    const icons = document.querySelectorAll('.section-icon');
    const currentPath = window.location.pathname;

    icons.forEach(icon => {
      const section = icon.getAttribute('data-section');
      const wrapper = icon.parentElement;
      const isDesign = currentPath.includes('/design');
      
      const isActive = (section === 'geometry' && isDesign) || (section === 'code' && !isDesign);
      
      if (isActive) {
        wrapper?.classList.add('opacity-100', 'bg-white/5');
        wrapper?.classList.remove('opacity-50');
      } else {
        wrapper?.classList.remove('opacity-100', 'bg-white/5');
        wrapper?.classList.add('opacity-50');
      }
    });
  });
</script>